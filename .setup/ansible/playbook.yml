---
- hosts: localhost
  connection: local
  become: false

  vars:
    common_packages:
      - git
      - nano
      - curl
      - wget
      - zsh

  tasks:
    # --- Debian / Ubuntu ---
    - name: Install packages (Debian/Ubuntu)
      ansible.builtin.apt:
        name: "{{ common_packages }}"
        state: present
        update_cache: true
      become: true
      when: ansible_facts['os_family'] == "Debian"

    - name: Install fastfetch (Ubuntu PPA)
      become: true
      block:
        - name: Add fastfetch PPA
          ansible.builtin.apt_repository:
            repo: ppa:zhangsongcui3371/fastfetch
            state: present
        - name: Install fastfetch
          ansible.builtin.apt:
            name: fastfetch
            state: present
            update_cache: true
      when: ansible_facts['distribution'] == "Ubuntu"

    # --- Arch Linux ---
    - name: Install packages (Arch)
      community.general.pacman:
        name: "{{ common_packages + ['fastfetch'] }}"
        state: present
        update_cache: true
      become: true
      when: ansible_facts['os_family'] == "Archlinux"

    # --- macOS ---
    - name: Install packages (macOS via Homebrew)
      community.general.homebrew:
        name: "{{ common_packages + ['fastfetch'] }}"
        state: present
      when: ansible_facts['os_family'] == "Darwin"
